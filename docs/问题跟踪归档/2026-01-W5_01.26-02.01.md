# 问题跟踪文档（2026年第5周）

> **周次**: 2026年1月第5周（1月26日-2月1日）
> **创建时间**: 2026年1月5日
> **最后更新**: 2026年1月29日 17:00
> **维护人**: Cursor AI + 用户

---

## 📋 使用说明

本文档用于跟踪本周（2026年1月26日-2月1日）的问题、Bug 和需求。

### 问题状态

| 状态 | 说明 |
|------|------|
| 🔴 待处理 | 新提出的问题，等待处理 |
| 🟡 处理中 | 正在解决中 |
| 🟢 已解决 | 问题已修复 |
| ⚪ 已关闭 | 问题已关闭（无需处理或重复） |

---

## 🟡 处理中

### #W5-001: 评论功能完整开发

**提出时间**: 2026年1月28日  
**优先级**: P1  
**状态**: 🟡 处理中（待确认）

**已完成的提交**：

| 提交ID | 描述 |
|--------|------|
| 617c8df | 评论/互动/用户服务层 |
| a3faca7 | 评论功能UI优化 |
| 1a92529 | 评论功能交互优化 |
| 63e560d | 连接线改为真正连续的弧线 |
| ac80c48 | 评论功能多项交互修复 |
| e6d8a84 | 三点菜单设计稿样式+安全区域+交互修复 |
| 0247cee | 菜单交互优化+拖拽手势+胶囊按钮样式 |
| d7f131a | 菜单精致化+拖拽修复+iOS日期兼容 |

---

**用户反馈（第11轮）**：
1. 回复弹窗中王小二、王大二的回复右边没有三点菜单显示
2. 原评论（王小利）需要灰色背景色块（YouTube风格）
3. 评论列表页面「评论」与「最热门」按钮间距太近

**AI回复（第11轮修复）**：

1. ✅ **回复弹窗三点菜单修复**
   - 将 `.reply-menu` 从 `position: absolute` 改为 flex 布局
   - 使用 `flex-shrink: 0; margin-left: auto;` 确保始终显示在右侧
   - 增大三点图标：`24rpx` → `28rpx`

2. ✅ **原评论灰色背景**
   - 添加 `background: #f5f5f5`
   - 添加 `border-radius: 16rpx`
   - 添加 `margin: 0 16rpx` 左右边距

3. ✅ **评论标题与排序按钮间距**
   - `.comments-title` margin-bottom：`24rpx` → `32rpx`
   - `.sort-tabs` margin-bottom：`32rpx` → `40rpx`

**修改文件**：
- `ReplyPanel.scss` - 三点菜单flex布局、原评论灰色背景
- `CommentList.scss` - 评论标题间距

**待确认**：请测试后反馈

回复：1、回复弹窗的页面：原评论与回复评论之间的连接线断开了，是不是因为加了灰色背景的原因？
     2、回复弹窗的页面：我发现，三点样式的菜单不能在空白处点击取消，仍然需要点击三点才能取消，需要进行调整
     3、评论标题与排序按钮间距，依旧没有任何变化
     4、回复弹窗中王小二、王大二的回复右边依旧没有三点菜单显示

**AI回复（第12轮修复）**：

1. ✅ **连接线断开修复**
   - 将连接线移出 `.avatar-area`，改为挂在 `.original-comment` 上
   - 使用 `bottom: -24rpx` 延伸到回复列表，确保上下连续
   - 调整回复弧线起点：`left -40rpx` → `-24rpx`，宽度 `40rpx` → `24rpx`

2. ✅ **回复弹窗菜单空白处可取消**
   - 新增 `handleOverlayClick` / `handlePanelClick`，空白处点击优先关闭菜单
   - 仅当无菜单展开时才关闭弹窗

3. ✅ **评论标题与排序按钮间距修复**
   - 在 `comment/index.scss` 中调整实际生效样式
   - `.comments-title` margin-bottom：`24rpx` → `32rpx`
   - `.sort-tabs` margin-bottom：`24rpx` → `40rpx`

4. ✅ **回复三点菜单确保显示**
   - `.reply-content` 添加 `min-width: 0` 允许收缩
   - `.reply-item`/`.reply-menu` 顶部对齐，避免被挤出

**修改文件**：
- `ReplyPanel.tsx` - 菜单空白关闭逻辑、连接线位置调整
- `ReplyPanel.scss` - 连接线续接、弧线位置、回复菜单布局
- `comment/index.scss` - 评论标题与排序间距


回复：1、回复弹窗的页面：原评论与回复评论之间的连接线断开了
     2、评论标题与排序按钮间距，依旧没有任何变化
     3、回复弹窗中王小二、王大二的回复右边依旧没有三点菜单显示（这个问题没有找到根本原因，我需要你彻底找到原因）

**AI回复（第13轮修复 - 根因分析）**：

**根因分析**：

1. **连接线断开**：原评论添加了 `margin: 0 16rpx` 后，头像中心的绝对位置变成了 `16rpx + 32rpx + 36rpx = 84rpx`，但回复列表的主线位置没有同步调整

2. **间距没变化**：`CommentList.tsx` 引入的是 `CommentList.scss`，而非 `index.scss`。之前我修改的是错误的文件

3. **三点菜单不显示**：`.reply-content` 使用 `flex: 1` 会占满剩余空间，导致 `.reply-menu` 被挤出可视区域。需要使用 `flex: 1 1 0` 并给 `.reply-menu` 设置固定宽度

**修复方案**：

1. ✅ **连接线完整重构**
   - 原评论：使用 `&.has-replies::after` 伪元素从头像底部向下延伸
   - 回复列表：使用 `.replies-list::before` 画主垂直线，位置对齐 `83rpx`
   - 弧线：调整 `left: -21rpx` 精确对齐主线

2. ✅ **间距修复（正确文件）**
   - 修改 `CommentList.scss`（实际生效的样式文件）
   - `.comments-title`: 字体 `32rpx` → `36rpx`，间距 `32rpx`
   - `.sort-tabs`: 间距 `40rpx` → `48rpx`

3. ✅ **三点菜单根本修复**
   - `.reply-content`: 改用 `flex: 1 1 0; min-width: 0; overflow: hidden;`
   - `.reply-menu`: 使用 `flex: 0 0 auto; width: 48rpx; position: relative;`
   - 菜单下拉改为 `top: 100%; right: 0;` 相对于 `.reply-menu` 定位

**修改文件**：
- `ReplyPanel.tsx` - 添加 `has-replies` 类名
- `ReplyPanel.scss` - 连接线完整重构、flex 布局修复
- `CommentList.scss` - 间距修复（正确文件）

---

## 📝 2026年1月29日 工作记录

### 完成内容

1. 连接线断开修复（原评论 → 回复列表）
2. 回复弹窗空白处点击可关闭菜单
3. 评论标题与排序按钮间距修复（生效样式）
4. 回复三点菜单可见性增强

---

## 🔗 相关文档

- [项目进度文档](../1-项目进度文档.md)
- [代码规范文档](../2-代码规范文档.md)
- [技术债务清单](../技术债务清单.md)

---

**归档提醒**: 本周日（2月1日）将本周问题归档
