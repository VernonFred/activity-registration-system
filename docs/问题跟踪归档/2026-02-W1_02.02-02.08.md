# 问题跟踪文档（2026年第6周）

> **周次**: 2026年2月第1周（2月2日-2月8日）
> **创建时间**: 2026年1月5日
> **最后更新**: 2026年1月5日
> **维护人**: Cursor AI + 用户

---

## 📋 使用说明

本文档用于跟踪本周（2026年2月2日-2月8日）的问题、Bug 和需求。

### 问题状态

| 状态 | 说明 |
|------|------|
| 🔴 待处理 | 新提出的问题，等待处理 |
| 🟡 处理中 | 正在解决中 |
| 🟢 已解决 | 问题已修复 |
| ⚪ 已关闭 | 问题已关闭（无需处理或重复） |

### 优先级

| 优先级 | 说明 |
|--------|------|
| P0 | 紧急，阻塞开发 |
| P1 | 高优先级，尽快处理 |
| P2 | 中优先级，正常排期 |
| P3 | 低优先级，有空处理 |

---

## 🟡 处理中

> 本周暂无处理中的问题

---

## 🔴 待处理

> 本周暂无待处理的问题

---

## 🟢 已解决

> 本周暂无已解决的问题

---

## ⚪ 已关闭

> 本周暂无已关闭的问题

---

## 📊 本周统计

| 指标 | 数值 |
|------|------|
| 总问题数 | 0 |
| 处理中 | 0 |
| 待处理 | 0 |
| 已完成 | 0 |
| 已关闭 | 0 |

---

## 🔗 相关文档

- [每日工作报告](../每日工作报告.md) - 每日工作记录
- [项目进度文档](../1-项目进度文档.md) - 整体进度
- [下一步规划文档](../16-下一步规划文档.md) - 下一步计划

---

**归档提醒**: 本周日（2月8日）或下周一（2月9日）将本周问题归档并切换到下周文档


回复：1、「我的评分」这里，为什么还是要显示数字"0"，这里的是又算法逻辑吗？评分是星级评分，完整的是5颗星，代表5分，如果我没有进行没有任何评分，「我的评分」就不要显示任何数字
     2、回复弹窗，还有一点小问题
        1、直线超出了最后回复评论的头像了
        2、你看下，王小利到王小二的连接，弯曲的线没有在直线上面，直线和弯曲的线错位了
你先仔细评估下问题出在哪里，你是否需要我去找一下关于这种弯曲连接线的代码样式（YouTube的网页检查器中可不可以看到？）

---

### AI分析与回复（2026年2月3日）

#### 1. "我的评分 0" 问题分析

我检查了 `RatingSection.tsx`，代码逻辑：

```tsx
const hasRated = rating.user_rating && rating.user_rating > 0
// 第62行 - 只显示"我的评分"文字
<Text className="my-rating-label">我的评分</Text>
// 第63-75行 - 只有 hasRated=true 时才显示星星
{hasRated && (...)}
```

**代码本身是正确的**，当 `user_rating = 0` 时不应显示数字。

**可能原因**：
- 小程序/开发工具缓存了旧编译代码
- 需要重新编译：`npm run dev:weapp`

**我的解决方案**：我会再次检查所有渲染user_rating的地方，添加更明确的条件判断。

#### 2. 连接线问题分析

看截图我理解了两个问题：

**问题2.1 - 直线超出最后回复头像**
- 主干线 `.line` 使用 `flex: 1` 撑满剩余空间
- 没有根据实际回复数量动态截断
- **需要改为固定高度或使用遮盖层**

**问题2.2 - 弯曲线与直线错位**
- 弯曲线 `::before` 的 `left: -56rpx` 与主干线位置不对齐
- 主干线在头像中心 (32rpx = 64rpx / 2)
- 弯曲线起点应该精确对齐到这个位置

**计算分析**：
```
主头像宽度: 64rpx
主头像中心: 32rpx
主干线位置: left: 32rpx (在头像中心)

一级回复区域负边距: margin-left: -80rpx
弯曲线 left: -56rpx
实际位置: -80rpx + (-56rpx) = 需要重新计算

问题: 弯曲线的 left 值没有对准主干线
```

#### YouTube样式参考？

**可以的！** 如果您能从YouTube网页检查器截取以下CSS信息会很有帮助：
1. 主干线的 `position`、`left`、`width` 值
2. 弯曲线的 `border-radius` 和定位
3. 嵌套层级的 `margin-left` / `padding-left`

**我现在先进行修复。**

---

### 第27轮修复（2026年2月3日）

#### 已修复内容：

1. ✅ **"我的评分 0" 问题**
   - 将 `MOCK_RATING.user_rating = 0` 改为 `undefined`
   - `0` 表示"0分"，`undefined` 表示"未评分"
   - 文件：`constants.ts`、`CommentTab.tsx`

2. ✅ **连接线对齐问题**
   - 弯曲线 `left` 值从 `-56rpx` 调整为 `-48rpx`
   - 对齐到主干线位置（头像中心 32rpx - 负边距 80rpx = -48rpx）

3. ✅ **直线超出问题**
   - 移除 `.line` 元素的 `flex: 1`
   - 改用 CSS 伪元素 `::after` 绘制主干线
   - 添加 `.has-replies` 类控制线条显示
   - 最后一个回复项添加白色遮盖层 `::after` 截断多余线条

**修改文件**：
- `constants.ts` - user_rating 改为 undefined
- `CommentTab.tsx` - user_rating 改为 undefined  
- `ReplyPanel.tsx` - 添加 has-replies 类，移除 .line 元素
- `ReplyPanel.scss` - 重构主干线为伪元素，添加遮盖层

---

### 第28轮修复（2026年2月3日）- 基于Sketch设计稿

#### 从Sketch设计稿获取的连接线规格

通过MCP工具读取「小程序端设计.sketch」中的评论回复设计稿，获取到：

| 属性 | 设计稿规格 |
|------|-----------|
| 主干线颜色 | `#e5e5e5` |
| 主干线宽度 | `0.5px` |
| 弯曲线样式 | L形状，从主干线弯曲到回复头像左侧 |

#### 修改内容

1. ✅ **连接线颜色和宽度调整**
   - 添加 SCSS 变量统一管理：
     ```scss
     $thread-line-color: #e5e5e5;  // 匹配Sketch设计稿
     $thread-line-width: 1rpx;     // 0.5px ≈ 1rpx on 2x screens
     ```
   - 所有连接线使用统一变量

2. ✅ **遮盖层高度增加**
   - 从 `200rpx` 增加到 `500rpx`
   - 确保完全覆盖超出主干线的任何剩余部分

3. ✅ **弯曲线位置微调**
   - `top` 值从 `16rpx` 调整为 `12rpx`
   - `height` 值调整为更合适的数值

**导出的设计参考图**：
- `comment-reply-design.png` - 回复弹窗设计稿
- `comment-unrated.png` - 未评分状态（显示"暂未评分"）
- `my-comments.png` - 我的评论页面

**修改文件**：
- `ReplyPanel.scss` - 连接线样式调整，匹配Sketch设计稿规格
