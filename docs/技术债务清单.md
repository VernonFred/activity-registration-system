# 技术债务清单

> **创建时间**: 2026年1月5日 16:30
> **维护人**: Claude AI
> **更新频率**: 每完成一个任务后更新

---

## 📋 债务分类

- **P0 - 紧急**: 影响核心功能，需要立即解决
- **P1 - 高优先级**: 影响用户体验，建议2周内解决
- **P2 - 中优先级**: 优化项，建议1个月内解决
- **P3 - 低优先级**: 可延后处理的改进

---

## 🔴 P0 - 紧急债务

> 当前无紧急债务

---

## 🟠 P1 - 高优先级债务

### #TD-001: 互动按钮图标优化

**创建时间**: 2026年1月5日
**负责人**: 待分配
**预计工时**: 2小时

**问题描述**:
当前使用CSS filter将灰色图标转换为橙色，微信小程序不支持SVG图标。

**临时方案**:
```scss
// 使用CSS filter高亮
.action-icon {
  filter: brightness(0);
  opacity: 0.45;
}

.active .action-icon {
  filter: brightness(0) saturate(100%) invert(55%) ...;
}
```

**理想方案**:
准备双状态PNG图标资源（未选中/已选中）：
- `bookmark.png` / `bookmark-active.png`
- `heart.png` / `heart-active.png`
- `message-circle.png` / `message-circle-active.png`
- `share.png` / `share-active.png`

**优先级理由**:
- 视觉效果不够精准（filter转换有色差）
- 维护成本高（每次调整颜色需要计算复杂filter参数）

**相关文件**:
- `frontend/app/src/pages/activities/index.scss:482-600`
- `frontend/app/src/pages/activities/components/ActivityCard.tsx:26-30`

**参考文档**:
- 问题跟踪: [2026-01-W2_01.05-01.11.md#001](./问题跟踪归档/2026-01-W2_01.05-01.11.md)

### #TD-005: 评论三点菜单图标替换

**创建时间**: 2026年1月29日
**负责人**: 待分配
**预计工时**: 1小时

**问题描述**:
评论功能的三点菜单中的图标目前使用emoji占位（💬、🗑️），需要替换为统一设计的图标资源。

**当前实现**:
```tsx
// CommentList.tsx / ReplyPanel.tsx
<Text className="action-icon">💬</Text>  // 回复图标
<Text className="action-icon">🗑️</Text>   // 删除图标
```

**理想方案**:
准备统一的图标资源（PNG或SVG）：
- `icon-reply.png` - 回复气泡图标（黑色描边）
- `icon-delete.png` - 垃圾桶图标（红色）

**相关文件**:
- `frontend/app/src/pages/comment/components/CommentList.tsx:109-118`
- `frontend/app/src/pages/comment/components/ReplyPanel.tsx:170-176`
- `frontend/app/src/pages/comment/components/ReplyPanel.tsx:213-219`

**备注**:
用户会统一提供所有图标资源后进行替换

---

## 🟡 P2 - 中优先级债务

### #TD-002: 评论功能完整实现

**创建时间**: 2026年1月5日
**负责人**: 待分配
**预计工时**: 2天

**问题描述**:
活动详情页评论功能尚未实现，当前仅显示"评论功能开发中"提示。

**需要实现**:
1. **详情页新增评论Tab** - 设计已有（活动详情页面-评论-*.png）
2. **评论列表组件** - 展示评论内容、作者、时间、回复
3. **评论提交表单** - 输入框、评分、提交逻辑
4. **回复功能** - 评论嵌套回复

**后端API状态**:
- ✅ GET `/activities/{id}/comments` - 已实现
- ✅ POST `/activities/{id}/comments` - 已实现
- ✅ DELETE `/activities/{id}/comments/{comment_id}` - 已实现

**相关文件**:
- `frontend/app/src/pages/activity-detail/index.tsx:574`
- `frontend/app/src/pages/activities/components/ActivityCard.tsx:140-147`

**参考文档**:
- API文档: [3-API接口文档.md#评论接口](./3-API接口文档.md)
- 设计稿: `小程序端设计/活动详情页面-评论-*.png`

---

## 🟢 P3 - 低优先级债务

### #TD-003: 动画性能优化（可选）

**创建时间**: 2026年1月5日
**负责人**: 待分配
**预计工时**: 4小时

**问题描述**:
当前动画使用setTimeout + state切换触发，在低端设备可能有轻微延迟。

**优化方向**:
1. 使用CSS animation-fill-mode控制动画结束状态
2. 考虑使用Taro的动画API（createAnimation）
3. 添加will-change提示浏览器优化

**优先级理由**:
- 当前实现已足够流畅
- 优化收益不明显
- 可等用户反馈后再决定

**相关文件**:
- `frontend/app/src/pages/activities/components/ActivityCard.tsx:62-65, 99-102`
- `frontend/app/src/pages/activities/index.scss:355-401`

---

### #TD-004: 收藏/点赞状态服务器同步

**创建时间**: 2026年1月5日
**负责人**: 待分配
**预计工时**: 1天

**问题描述**:
当前收藏/点赞状态仅存储在localStorage，跨设备不同步。

**理想方案**:
1. 用户登录后，从服务器获取收藏/点赞列表
2. 使用`setFavorites()` / `setLikes()`批量设置本地状态
3. 定期同步或在进入页面时同步

**后端API**:
- ✅ GET `/engagements/{activity_id}/engagement` - 返回用户互动状态

**实现位置**:
```typescript
// 在用户登录后调用
useEffect(() => {
  if (userLoggedIn) {
    syncEngagementFromServer()
  }
}, [userLoggedIn])

async function syncEngagementFromServer() {
  const activities = await fetchAllActivities()
  const favoriteIds = []
  const likeIds = []

  for (const activity of activities) {
    const engagement = await getEngagementSummary(activity.id)
    if (engagement.is_favorited) favoriteIds.push(activity.id)
    if (engagement.is_liked) likeIds.push(activity.id)
  }

  setFavorites(favoriteIds)
  setLikes(likeIds)
}
```

**相关文件**:
- `frontend/app/src/utils/storage.ts:222-228, 280-286`
- `frontend/app/src/services/engagements.ts:84-86`

---

## 📊 债务统计

| 优先级 | 数量 | 预计总工时 |
|--------|------|-----------|
| P0     | 0    | 0小时     |
| P1     | 2    | 18小时    |
| P2     | 1    | 1小时     |
| P3     | 2    | 1.5天     |
| **合计** | **5** | **~3天** |

---

## 🔄 已清偿债务

> 本文档创建时无历史债务

---

## 📝 变更记录

| 时间 | 操作 | 债务ID | 描述 |
|------|------|--------|------|
| 2026年1月5日 16:30 | 创建 | - | 初始化技术债务清单文档 |
| 2026年1月5日 16:30 | 新增 | #TD-001 | 互动按钮图标优化 |
| 2026年1月5日 16:30 | 新增 | #TD-002 | 评论功能完整实现 |
| 2026年1月5日 16:30 | 新增 | #TD-003 | 动画性能优化 |
| 2026年1月5日 16:30 | 新增 | #TD-004 | 收藏/点赞状态服务器同步 |
| 2026年1月29日 14:30 | 新增 | #TD-005 | 评论三点菜单图标替换 |

---

**下次更新时机**: 完成同行人员功能后
