# 下一步规划文档

> **创建时间**: 2025年12月08日 00:25  
> **最后更新**: 2025年12月09日 11:15  
> **维护人**: Cursor AI

---

## 📋 使用说明

本文档用于规划下一步开发任务。

- **待规划** → **进行中** → **已完成**（同步到 `1-项目进度文档.md`）
- 每个任务完成后，将其移动到"已完成"区域，并同步更新项目进度文档

---

## ✅ 已完成任务

### #P000 GitHub 仓库配置
- **完成时间**: 2025年12月08日 00:20
- **仓库地址**: https://github.com/VernonFred/activity-registration-system

### #P001 修复 H5 预览样式问题
- **完成时间**: 2025年12月09日 10:30
- **完成内容**: 修复 flex 布局、文字不换行、rem 适配脚本

### #P009 代码拆分重构
- **完成时间**: 2025年12月09日 09:30
- **完成内容**: TSX 组件拆分（4个页面），SCSS 合并回主文件

### #P010 报名列表页 UI 开发
- **完成时间**: 2025年12月09日 12:00
- **完成内容**: 
  - 页面基础结构 + 筛选栏组件（FilterBar）
  - 状态标签切换组件（StatusTabs）
  - 活动卡片组件（ActivityCard）
  - 列表数据渲染 + Mock 数据
  - 双主题适配（浅色/深色）
- **设计参考**: `lovable参考样式/截屏2025-12-09 10.04.11.png`

### #P011 活动议程嵌套结构重构
- **完成时间**: 2025年12月09日 19:30
- **实际时间**: 1.5 小时
- **完成内容**:
  - 数据模型扩展：`AgendaGroup`、`Speaker`、`AgendaItem`
  - 组件开发：`AgendaGroupCard`、`AgendaItemCard`、`AgendaTab`
  - UI 设计：橙色渐变头部 + 演讲人头像 + 主持人信息
  - Mock 数据：参考纸质版会议手册（3分组、12议程项）
  - 双主题适配：浅色/深色完整支持
- **设计参考**: 纸质版会议手册截图

### #P012 议程折叠/展开功能
- **完成时间**: 2025年12月09日 20:00
- **实际时间**: 15 分钟
- **完成内容**:
  - 状态管理：默认只展开第一个分组
  - 箭头图标：▼ 展开 / ▶ 折叠
  - 全部展开/折叠按钮：Tab 右上角橙色按钮
  - 点击反馈：头部缩放动画
  - 本地存储：记住每个活动的折叠状态
  - 双主题适配：浅色/深色完整支持
- **用户反馈**: 解决议程多时页面太长的问题

---

## 🔴 当前任务（进行中）

### #P002 活动详情页 UI 开发

- **创建时间**: 2025年12月08日 00:25
- **优先级**: P0
- **预计时间**: 3 小时
- **状态**: 🟡 进行中（下一个任务）
- **设计参考**: `小程序端设计/活动详情页面-*.png`
- **页面结构**:
  ```
  ┌─────────────────────────────────┐
  │ ← 返回        暑期培训会        │ 顶部导航
  ├─────────────────────────────────┤
  │ 活动速览│活动议程│酒店信息│图片直播│ Tab导航
  ├─────────────────────────────────┤
  │        [大图封面]              │
  │  长沙｜第十一届老客户暑期培训会 │
  │  [免费]                        │
  │  2023.03.30-2023.03.31         │
  │  04月14日00:00 截止报名        │
  │  长沙市｜喜来登大酒店           │
  │  目前报名人数：215人 🔥        │
  │  活动介绍...                   │
  ├─────────────────────────────────┤
  │  ⭐ 💬 ❤️ ↗️    [立即报名]    │ 底部浮岛
  └─────────────────────────────────┘
  ```
- **子任务**:
  - [ ] Step 1: 页面框架 + 顶部导航 + Tab 切换
  - [ ] Step 2: 活动速览 Tab（封面+信息+介绍）
  - [ ] Step 3: 底部胶囊浮岛（收藏/评论/点赞/分享/报名）
  - [ ] Step 4: 活动议程 Tab（时间轴）
  - [ ] Step 5: 双主题适配

---

### #P005 报名表单页开发

- **创建时间**: 2025年12月08日 00:25
- **优先级**: P0
- **预计时间**: 2.5 小时
- **状态**: 🔴 待开始
- **设计参考**: `小程序端设计/立即报名-*.png`, `lovable参考样式/截屏2025-12-09 10.04.42.png`
- **页面结构**:
  ```
  ┌─────────────────────────────────┐
  │  活动报名              [×]     │ 标题+关闭
  │  2025暑期培训会议               │ 副标题
  ├─────────────────────────────────┤
  │  ① ─── ② ─── ③ ─── ④         │ 步骤指示器
  │        个人信息                │ 步骤标题
  ├─────────────────────────────────┤
  │  姓名*        [输入框]         │
  │  学校*        [输入框]         │
  │  学院/部门*   [输入框]         │
  │  职位         [输入框]         │
  │  手机号码*    [输入] [快速获取]│
  ├─────────────────────────────────┤
  │       [下一步 →]               │ 底部按钮
  └─────────────────────────────────┘
  ```
- **子任务**:
  - [ ] Step 1: 步骤指示器组件（橙色圆圈+连接线）
  - [ ] Step 2: Step1 个人信息表单
  - [ ] Step 3: Step2 缴费信息表单
  - [ ] Step 4: Step3 住宿信息表单
  - [ ] Step 5: Step4 交通信息表单（到达+返程卡片）
  - [ ] Step 6: 报名成功页面
  - [ ] Step 7: 双主题适配

---

## 🟡 高优先级任务（P1）

### #P003 搜索功能前后端联调

- **优先级**: P1
- **预计时间**: 0.5 天
- **状态**: 🔴 待开始
- **子任务**:
  - [ ] 搜索 API 对接
  - [ ] 搜索结果展示
  - [ ] 最近搜索本地存储
  - [ ] 热门搜索数据获取

### #P006 我的页面开发

- **优先级**: P1
- **预计时间**: 1 天
- **状态**: 🔴 待开始
- **设计参考**: `小程序端设计/我的-*.png`, `小程序端设计/Profile.png`
- **子任务**:
  - [ ] 四 Tab（活动/徽章/通知/设置）
  - [ ] 个人信息展示
  - [ ] 我的报名列表

### #P013 多天会议议程分页功能

- **创建时间**: 2025年12月09日 19:40
- **优先级**: P1（待确认需求）
- **预计时间**: 1 小时
- **状态**: 🔴 待规划
- **需求来源**: 用户反馈 - 多天会议需要分页展示
- **依赖**: #P011、#P012 已完成
- **前置条件**: 
  - 需要确认后端数据结构
  - 需要了解实际会议天数范围
  - 需要确认是否有多天会议场景

#### 📋 功能设计

**核心功能**：
- [ ] 按日期分组（AgendaDay 数据结构）
- [ ] 日期 Tab 切换（第一天/第二天/第三天）
- [ ] 智能判断单天/多天（自动适配）
- [ ] 每天内的分组仍支持折叠
- [ ] 日期 Tab 横向滚动（支持5+天会议）

**数据结构**：
```typescript
interface AgendaDay {
  id: number
  date: string              // "2025-11-12"
  display_date: string      // "11月12日（第一天）"
  groups: AgendaGroup[]     // 该天的议程分组
}
```

**UI 设计**：
- 顶部日期 Tab（橙色渐变选中态）
- 日期 Tab 支持横向滚动
- 保持当前的折叠功能
- 当天议程统计（X个分组，Y个议程项）

**智能判断**：
```typescript
// 自动检测是否需要分页
- 分组 > 10个
- 总议程项 > 50个
- 跨越多天
```

#### 📐 实施步骤

**Step 1: 数据模型扩展** (15min)
- [ ] 新增 AgendaDay 类型
- [ ] Activity.agenda 支持 AgendaDay[]
- [ ] 类型守卫判断单天/多天

**Step 2: 日期 Tab 组件** (20min)
- [ ] 创建 AgendaDayTabs 组件
- [ ] 橙色渐变选中态样式
- [ ] 横向滚动支持

**Step 3: AgendaTab 重构** (15min)
- [ ] 多天渲染逻辑
- [ ] 保持折叠功能
- [ ] 状态管理优化

**Step 4: Mock 数据** (10min)
- [ ] 创建多天会议 Mock 数据
- [ ] 3天议程示例

---

## 🟡 高优先级任务（P1）- 议程重构

### #P011 活动议程嵌套结构重构

- **创建时间**: 2025年12月09日 18:00
- **完成时间**: 2025年12月09日 19:30
- **优先级**: P1（较大规划，分步骤实施）
- **实际时间**: 1.5 小时
- **状态**: ✅ 已完成
- **需求来源**: 用户反馈 - 支持"专题论坛 → 具体议程"嵌套结构
- **设计参考**: 纸质版会议手册议程样式
- **配色要求**: 匹配当前系统（橙色主题 + 双主题模式）

#### 📊 需求分析

**当前问题**：
- ❌ 议程为扁平结构，无法表达层级关系
- ❌ 不支持"专题论坛"分组
- ❌ 缺少主持人信息展示
- ❌ 缺少演讲人头像

**目标效果**（参考纸质版）：
```
议程安排 (11月12日 9:00-18:10)
├─ 开幕仪式 [9:00-9:30]  ← 深色头部
│  ├─ 主持人：张志东
│  ├─ 李炯 致辞
│  └─ 王仁祥 讲话
├─ 主旨报告  ← 深色头部
│  ├─ 主持人：刘建湘
│  ├─ 9:30-10:00 潘海生演讲
│  ├─ 10:00-10:30 丁金昌演讲
│  └─ 10:30-10:45 茶歇
└─ 职业教育高质量发展  ← 深色头部
   ├─ 主持人：陈静彬
   └─ 10:45-11:30 马晓明演讲
```

#### 🗂️ 数据模型设计

**新增类型**：
```typescript
// 议程分组（一级）
interface AgendaGroup {
  id: number
  title: string              // "开幕仪式"、"主旨报告"
  time_start?: string
  time_end?: string
  moderator?: {              // 主持人
    name: string
    title: string
    avatar?: string
  }
  items: AgendaItem[]        // 具体议程项
}

// 议程项扩展（二级）
interface AgendaItem {
  id: number
  time_start: string
  time_end: string
  type: 'speech' | 'break' | 'discussion' | 'activity'
  speaker?: {
    name: string
    title: string
    avatar?: string          // 新增：头像
  }
  title: string
  location?: string
  description?: string
}
```

#### 🎨 UI 设计规范

**配色方案**（匹配当前系统）：
- **浅色主题**：
  - 分组头部：`linear-gradient(135deg, #FF8A1A 0%, #FF6B00 100%)` （橙色渐变）
  - 卡片背景：`#FFFFFF`
  - 边框：`rgba(255, 138, 26, 0.2)`
  
- **深色主题**：
  - 分组头部：`linear-gradient(135deg, #FF8A1A 0%, #FF6B00 100%)`
  - 卡片背景：`#1F2937`
  - 边框：`rgba(255, 138, 26, 0.15)`

**组件层级**：
```
AgendaTab
├─ AgendaGroupCard      ← 新增：分组卡片
│  ├─ GroupHeader       ← 橙色渐变头部
│  ├─ ModeratorInfo     ← 主持人信息条
│  └─ AgendaItemList    ← 议程项列表
│     ├─ SpeechItem     ← 演讲项（带头像）
│     ├─ BreakItem      ← 茶歇项（简化样式）
│     └─ DiscussionItem ← 讨论项
└─ EmptyState           ← 空状态
```

#### 📋 实施计划（分 6 步）

**Step 1: 数据模型扩展** (0.5h)
- [ ] 扩展 `types.ts`：添加 `AgendaGroup` 类型
- [ ] 更新 `AgendaItem` 接口（添加 `speaker.avatar`、`type` 字段）
- [ ] 更新 Mock 数据（参考纸质版结构）

**Step 2: 分组头部组件** (1h)
- [ ] 创建 `AgendaGroupCard.tsx`
- [ ] 开发 `GroupHeader`（橙色渐变头部）
- [ ] 开发 `ModeratorInfo`（主持人信息条）
- [ ] 适配双主题配色

**Step 3: 议程项卡片重构** (1.5h)
- [ ] 重构 `AgendaItemCard.tsx`
- [ ] 添加演讲人头像显示
- [ ] 区分不同类型（演讲/茶歇/讨论）
- [ ] 优化卡片布局（参考纸质版）

**Step 4: 时间线样式调整** (0.5h)
- [ ] 调整时间线位置（适配分组结构）
- [ ] 区分一级/二级节点样式
- [ ] 优化连接线显示

**Step 5: 主 Tab 组件更新** (1h)
- [ ] 更新 `AgendaTab.tsx`（渲染分组结构）
- [ ] 添加折叠/展开功能（可选）
- [ ] 优化滚动性能

**Step 6: 样式适配与测试** (1.5h)
- [ ] SCSS 样式完善（`_agenda.scss`）
- [ ] 双主题完整适配
- [ ] 微信小程序测试
- [ ] H5 预览测试
- [ ] 响应式布局检查

#### 📦 交付物

- [x] 扩展的数据模型（`types.ts`）
- [x] 新增组件（`AgendaGroupCard.tsx`、`AgendaItemCard.tsx`）
- [x] 更新的样式文件（`_agenda.scss`）
- [x] Mock 测试数据
- [x] 文档更新（本文档 + 问题跟踪文档）

#### ⚠️ 注意事项

1. **渐进式开发**：每完成一步都要测试
2. **配色统一**：严格遵循橙色主题
3. **双主题适配**：每个组件都要支持浅色/深色
4. **性能优化**：大量数据时考虑虚拟滚动
5. **代码质量**：遵循约定文档中的行数限制

#### 🔗 相关文档

- `docs/8-问题跟踪文档.md` - 用户反馈记录
- `docs/1-项目进度文档.md` - 同步进度更新
- `docs/约定文档.md` - 代码规范约定
- `小程序端设计/活动详情页面-活动议程.png` - 原设计稿

---

## 🟢 中优先级任务（P2）

### #P007 图标统一替换

- **优先级**: P2
- **预计时间**: 0.5 天
- **状态**: 🔴 待开始

### #P008 AI 助手页面开发

- **优先级**: P2
- **预计时间**: 1 天
- **状态**: 🔴 待开始

---

## 📅 本周详细计划（2025年12月09日 - 12月14日）

### 📆 12月09日（周一）- 今日

| 时间段 | 任务 | 子任务 | 预计时长 |
|--------|------|--------|----------|
| 上午 | #P010 报名列表页 | Step 1: 页面结构 + 筛选栏 | 30min |
| 上午 | #P010 报名列表页 | Step 2: 状态标签切换 | 20min |
| 上午 | #P010 报名列表页 | Step 3: 活动卡片组件 | 40min |
| 下午 | #P010 报名列表页 | Step 4: 列表渲染 + Mock | 20min |
| 下午 | #P010 报名列表页 | Step 5: 双主题适配 | 30min |
| 下午 | #P002 活动详情页 | Step 1: 页面框架 + Tab | 40min |

**今日目标**: 完成报名列表页 + 开始活动详情页

---

### 📆 12月10日（周二）

| 时间段 | 任务 | 子任务 | 预计时长 |
|--------|------|--------|----------|
| 上午 | #P002 活动详情页 | Step 2: 活动速览 Tab | 50min |
| 上午 | #P002 活动详情页 | Step 3: 底部胶囊浮岛 | 40min |
| 下午 | #P002 活动详情页 | Step 4: 活动议程 Tab | 50min |
| 下午 | #P002 活动详情页 | Step 5: 双主题适配 | 40min |

**今日目标**: 完成活动详情页（速览+议程+底部浮岛）

---

### 📆 12月11日（周三）

| 时间段 | 任务 | 子任务 | 预计时长 |
|--------|------|--------|----------|
| 上午 | #P005 报名表单页 | Step 1: 步骤指示器组件 | 30min |
| 上午 | #P005 报名表单页 | Step 2: 个人信息表单 | 40min |
| 下午 | #P005 报名表单页 | Step 3: 缴费信息表单 | 30min |
| 下午 | #P005 报名表单页 | Step 4: 住宿信息表单 | 30min |

**今日目标**: 完成报名表单 Step 1-4

---

### 📆 12月12日（周四）

| 时间段 | 任务 | 子任务 | 预计时长 |
|--------|------|--------|----------|
| 上午 | #P005 报名表单页 | Step 5: 交通信息表单 | 40min |
| 上午 | #P005 报名表单页 | Step 6: 报名成功页 | 30min |
| 下午 | #P005 报名表单页 | Step 7: 双主题适配 | 30min |
| 下午 | H5 测试 | 测试所有新页面 | 30min |

**今日目标**: 完成报名表单页 + H5 测试

---

### 📆 12月13日（周五）

| 时间段 | 任务 | 子任务 | 预计时长 |
|--------|------|--------|----------|
| 上午 | #P003 搜索联调 | 搜索 API 对接 | 1h |
| 下午 | #P003 搜索联调 | 搜索结果 + 历史存储 | 1h |
| 下午 | 代码整理 | Git 提交 + 文档同步 | 30min |

**今日目标**: 完成搜索功能联调

---

### 📆 12月14日（周六）

| 时间段 | 任务 | 子任务 | 预计时长 |
|--------|------|--------|----------|
| 上午 | #P006 我的页面 | 页面框架 + 四Tab | 1h |
| 下午 | #P006 我的页面 | 活动列表 + 个人信息 | 1.5h |
| 下午 | 周回顾 | 更新进度文档 | 30min |

**今日目标**: 完成我的页面基础框架

---

## 📊 任务统计

| 优先级 | 待开始 | 进行中 | 已完成 |
|--------|--------|--------|--------|
| P0 紧急 | 2 | 1 | 2 |
| P1 高 | 2 | 0 | 0 |
| P2 中 | 2 | 0 | 0 |
| **合计** | **6** | **1** | **2** |

---

## 📋 开发顺序说明

```
报名列表页 → 活动详情页 → 报名表单页 → 搜索联调 → 我的页面
     ↓            ↓            ↓
  底部导航      从列表页     从详情页
  "报名"Tab    点击进入     点击"立即报名"
```

**页面关联**:
1. **报名列表页**: 底部导航"报名"Tab 的主页面
2. **活动详情页**: 从列表页点击活动卡片进入
3. **报名表单页**: 从详情页点击"立即报名"弹出

---

## 🔗 前后端数据对接计划

### 📊 现有后端 API 覆盖情况

| 前端页面 | 需要的 API | 后端状态 | 备注 |
|----------|-----------|----------|------|
| **报名列表页** | `GET /activities` | ✅ 已有 | 需确认筛选参数 |
| **报名列表页** | 活动评分 | ⚠️ 需聚合 | feedbacks 表有 rating，需计算平均分 |
| **活动详情页** | `GET /activities/{id}` | ✅ 已有 | - |
| **活动详情页** | `GET /activities/{id}/engagement` | ✅ 已有 | 收藏/点赞/分享数量 |
| **活动详情页** | `GET /activities/{id}/comments` | ✅ 已有 | 评论列表 |
| **活动详情页** | `POST /activities/{id}/favorite` | ✅ 已有 | 收藏功能 |
| **活动详情页** | `POST /activities/{id}/like` | ✅ 已有 | 点赞功能 |
| **活动详情页** | `POST /activities/{id}/share` | ✅ 已有 | 分享记录 |
| **报名表单页** | `POST /signups` | ✅ 已有 | 提交报名 |
| **报名表单页** | `POST /signups/{id}/companions` | ✅ 已有 | 同行人员 |
| **我的页面** | `GET /users/me` | ✅ 已有 | 用户信息 |
| **我的页面** | `GET /badges/me` | ✅ 已有 | 我的徽章 |
| **我的页面** | `GET /notifications/me` | ✅ 已有 | 我的通知 |

### ⚠️ 需要后端补充的内容

#### 1. 数据库字段补充

| 表名 | 需新增字段 | 类型 | 说明 | 优先级 |
|------|-----------|------|------|--------|
| activities | `city` | VARCHAR(50) | 城市（用于筛选） | P1 |
| activities | `is_free` | BOOLEAN | 是否免费 | P1 |
| activities | `price` | DECIMAL | 价格（免费为0） | P2 |
| activities | `agenda` | JSON | 活动议程（时间+标题+主讲人） | P1 |
| activities | `avg_rating` | DECIMAL | 平均评分（冗余字段，提升查询效率） | P2 |
| activities | `signup_count` | INTEGER | 报名人数（冗余字段） | P2 |

#### 2. API 参数补充

| 接口 | 需补充参数 | 说明 | 优先级 |
|------|-----------|------|--------|
| `GET /activities` | `city` | 按城市筛选 | P1 |
| `GET /activities` | `status` | 按状态筛选（已开始/已结束/延期） | P1 |
| `GET /activities` | `start_time_from`, `start_time_to` | 按时间范围筛选 | P1 |
| `GET /activities` | `sort_by` | 排序方式 | P2 |

#### 3. 可能需要新增的 API

| 接口 | 描述 | 优先级 |
|------|------|--------|
| `GET /activities/featured` | 热门精选活动 | P2 |
| `GET /activities/hot-searches` | 热门搜索词 | P3 |
| `GET /activities/{id}/agenda` | 活动议程详情 | P1 |

### 📆 后端调整计划

| 阶段 | 时间 | 任务 | 说明 |
|------|------|------|------|
| **Phase 1** | 前端开发时 | 使用 Mock 数据 | 先完成 UI，不阻塞开发 |
| **Phase 2** | 页面完成后 | 确认 API 参数 | 与后端核对字段 |
| **Phase 3** | 联调阶段 | 补充缺失字段/API | 按优先级补充 |
| **Phase 4** | 测试阶段 | 端到端测试 | 验证完整流程 |

### 🔄 Mock 数据 → 真实 API 切换

```typescript
// config/index.ts
export const CONFIG = {
  USE_MOCK: true,  // Phase 1-2: true（使用 Mock）
                   // Phase 3-4: false（使用真实 API）
  API_BASE_URL: 'http://localhost:8000/api/v1',
}
```

**当前策略**：
1. 前端先用 Mock 数据完成 UI 开发
2. 每个页面完成后，记录需要的 API 字段
3. 统一进行后端补充和联调
4. 避免前端开发被后端阻塞

---

## 📝 变更记录

| 时间 | 变更内容 | 操作人 |
|------|----------|--------|
| 2025年12月09日 11:20 | 添加前后端数据对接计划，分析 API 覆盖情况 | Cursor AI |
| 2025年12月09日 11:15 | 重构文档，添加报名列表页，制定详细周计划 | Cursor AI |
| 2025年12月08日 00:25 | 创建文档，初始化任务列表 | Cursor AI |

---

**下次更新**: 任务状态变更时同步更新
