# 业务流程检查规范

> **约定**：每当**完成 4 个页面**或**完成一条完整业务流程**（例如：活动列表 → 活动详情 → 报名 → 报名结果）后，  
> 必须启动一次 **「业务流程检查」**，对当前这组页面进行**前端 + 后端 + 业务流程**的全面自检，  
> **目标**：这组页面达到「可以当成真实线上功能使用」的标准，而不是半成品 Demo。

> **创建时间**: 2025年12月10日  
> **最后更新**: 2025年12月10日 20:15  
> **维护人**: 用户 + Cursor AI

---

## 📋 使用场景

### 触发时机

| 场景 | 示例 | 触发条件 |
|------|------|----------|
| **页面数量** | 完成 4 个相关页面 | ✅ 自动触发 |
| **业务流程** | 活动列表→详情→报名→结果 | ✅ 自动触发 |
| **用户指令** | "对这几个页面进行流程检查" | ✅ 手动触发 |
| **阶段节点** | 第一期功能开发完成 | ✅ 里程碑检查 |

### 指令示例

用户输入以下指令时，AI 需按本规范执行检查：

```text
✅ "对这几个页面进行'页面流程检查'。"
✅ "这条业务流程已经有 UI 了，请进入页面流程检查模式。"
✅ "检查报名流程是否能走通。"
✅ "第一期功能开发完成，进行全面检查。"
```

---

## 🔍 检查清单（五大模块）

### 一、页面级检查（前端）

#### 1.1 路由与页面跳转 ✅

**检查项**：
- [ ] 每个页面能从正常入口进入（列表 → 详情 → 表单 → 结果）
- [ ] 页面跳转参数正确传递（如 `activityId`、`tab`）
- [ ] 参数接收方式统一（`useRouter` / `onLoad`）
- [ ] 参数缺失时有兜底处理（默认值 / 返回上一页）

**AI 需要做的**：
- ✅ 列出所有页面的路由路径和参数
- ✅ 检查参数传递是否一致
- ✅ 添加参数校验和错误处理
- ✅ 统一跳转方式（`Taro.navigateTo` / `redirectTo`）

**输出格式**：
```markdown
| 页面 | 路径 | 参数 | 来源页面 | 状态 |
|------|------|------|----------|------|
| 活动列表 | /pages/activities/index | - | TabBar | ✅ |
| 活动详情 | /pages/activity-detail/index | id | 活动列表 | ✅ |
| 报名表单 | /pages/signup/index | activity_id | 活动详情 | ⚠️ 参数需校验 |
```

---

#### 1.2 数据加载与状态管理 ✅

**检查项**：
- [ ] 数据来源明确（接口 / 缓存 / 全局状态）
- [ ] 避免重复请求（复用机制）
- [ ] 使用统一的请求封装（`services/` 文件夹）
- [ ] Loading 状态管理（加载中 / 成功 / 失败）
- [ ] 空状态处理（无数据提示）

**AI 需要做的**：
- ✅ 检查是否使用统一的 `services` 文件
- ✅ 确保每个请求都有 loading 状态
- ✅ 添加空状态和骨架屏
- ✅ 避免页面内直接写 `Taro.request`

**输出格式**：
```markdown
| 页面 | 数据来源 | 请求封装 | Loading | 空状态 | 状态 |
|------|----------|----------|---------|--------|------|
| 活动列表 | fetchActivities() | ✅ | ✅ | ✅ | ✅ |
| 活动详情 | fetchActivityDetail() | ✅ | ✅ | ✅ | ✅ |
```

---

#### 1.3 错误处理与提示 ✅

**检查项**：
- [ ] 接口失败有友好提示（网络错误 / 服务器异常）
- [ ] 区分系统错误和业务错误
- [ ] 表单校验错误有明确提示
- [ ] 使用统一的 Toast / Modal 组件

**AI 需要做的**：
- ✅ 为所有接口添加 try/catch
- ✅ 统一错误提示文案
- ✅ 区分错误类型（网络 / 权限 / 业务）
- ✅ 记录错误日志（console.error）

**示例代码**：
```typescript
try {
  const data = await fetchActivityDetail(id)
  setActivity(data)
} catch (error) {
  console.error('加载活动失败:', error)
  Taro.showToast({ 
    title: error.message || '加载失败，请稍后重试', 
    icon: 'none' 
  })
}
```

---

#### 1.4 表单与交互校验 ✅

**检查项**（如有表单）：
- [ ] 必填项前端校验
- [ ] 格式校验（手机号 / 邮箱 / 身份证）
- [ ] 提交按钮防重复点击
- [ ] 提交成功有明确反馈

**AI 需要做的**：
- ✅ 添加表单校验规则
- ✅ 提交时禁用按钮（loading 状态）
- ✅ 校验失败指向具体字段
- ✅ 提交成功跳转或提示

---

#### 1.5 UI 一致性与体验 ✅

**检查项**：
- [ ] 按钮样式统一（主按钮 / 次按钮）
- [ ] 间距、圆角、阴影符合设计规范
- [ ] 交互符合平台习惯（微信小程序 / H5）
- [ ] 主题适配完整（浅色 / 深色）

**AI 需要做的**：
- ✅ 统一使用设计系统变量（`$light-primary`）
- ✅ 抽取通用组件和样式
- ✅ 确保双主题完整适配
- ✅ 检查响应式布局

---

### 二、接口与数据检查（后端 + 接口层）

#### 2.1 接口清单完整性 ✅

**AI 需要做的**：
- ✅ 输出本组页面的接口清单表格

**输出格式**：
```markdown
| 接口 | Method | 用途 | 参数 | 返回 | 状态 |
|------|--------|------|------|------|------|
| /api/activities | GET | 活动列表 | page, status | items[], total | ✅ |
| /api/activities/:id | GET | 活动详情 | id (path) | Activity | ✅ |
| /api/registrations | POST | 提交报名 | activity_id, ... | Registration | ⚠️ 待开发 |
```

---

#### 2.2 请求参数与返回结构 ✅

**检查项**：
- [ ] 参数类型明确（path / query / body）
- [ ] 返回结构统一（`{ code, message, data }`）
- [ ] 列表接口统一（`items` + `total` + 分页）
- [ ] 字段命名统一（前后端一致）

**AI 需要做的**：
- ✅ 检查命名不一致的字段（如 `meetingId` vs `id`）
- ✅ 统一返回结构
- ✅ 添加类型定义（TypeScript）

---

#### 2.3 错误与边界场景 ✅

**检查项**：
- [ ] 数据不存在（404）
- [ ] 权限不足（403）
- [ ] 未登录（401）
- [ ] 业务限制（报名截止 / 名额已满）
- [ ] 重复操作（重复报名）

**AI 需要做的**：
- ✅ 为每种错误场景定义错误码和提示文案
- ✅ 前端根据错误码展示不同提示
- ✅ 记录到 `docs/3-API接口文档.md` 中

---

### 三、端到端业务流程检查

#### 3.1 完整流程能否走通 ✅

**AI 需要做的**：
- ✅ 用文字描述完整流程的数据流
- ✅ 标记哪些步骤使用 Mock 数据
- ✅ 标记哪些步骤已真实实现

**输出格式**：
```markdown
**报名流程数据流**：

1. 活动列表页 → 调用 `GET /api/activities`
   - 返回活动列表（真实接口 ✅）
   
2. 点击活动卡片 → 跳转到详情页，带参数 `id`
   - 调用 `GET /api/activities/:id`
   - 返回活动详情（真实接口 ✅）
   
3. 点击"立即报名" → 跳转到报名表单，带参数 `activity_id`
   - 页面渲染（Mock 数据 ⚠️）
   
4. 填写表单并提交 → 调用 `POST /api/registrations`
   - 后端写入数据库（待开发 ❌）
   
5. 报名成功 → 跳转到成功页面
   - 页面渲染（待开发 ❌）
```

---

#### 3.2 数据持久化与一致性 ✅

**检查项**：
- [ ] 提交的数据真实写入数据库
- [ ] 刷新页面数据能正确回显
- [ ] 关键字段记录完整（用户 ID、时间戳）

**AI 需要做的**：
- ✅ 明确标注哪些是 Mock 数据
- ✅ 给出从 Mock 到真实数据的改造建议
- ✅ 确保本地存储和接口数据一致

---

### 四、自测用例清单

**AI 需要做的**：
- ✅ 输出可直接执行的测试用例

**格式要求**：
```markdown
### 【用例 1】正常报名流程

**前置条件**：
- 用户已登录
- 至少有 1 个可报名的活动

**操作步骤**：
1. 打开活动列表页
2. 点击任意活动卡片进入详情页
3. 点击"立即报名"按钮
4. 填写表单所有必填项并提交
5. 查看报名成功提示

**预期结果**：
- ✅ 每一步无报错、无空白页
- ✅ 成功提示清晰明确
- ✅ 在"我的报名"中能看到记录

---

### 【用例 2】表单校验

**操作步骤**：
1. 进入报名表单页
2. 不填写必填项，直接点击提交

**预期结果**：
- ✅ 显示错误提示："请填写姓名"
- ✅ 提交按钮未执行请求
```

---

### 五、输出检查报告

**AI 最终输出**：

```markdown
# 业务流程检查报告

## 1️⃣ 检查范围
- 涉及页面：X 个
- 业务流程：XXX → XXX → XXX
- 涉及接口：Y 个

## 2️⃣ 前端检查结果
- ✅ 已修复：路由参数统一、错误处理、空状态
- ⚠️ 待完善：表单校验、重复提交防护

## 3️⃣ 接口检查结果
- ✅ 已完成：X 个接口
- ❌ 待开发：X 个接口
- 接口清单：[表格]

## 4️⃣ 业务流程检查
- 数据流描述：[详细说明]
- Mock 数据标记：[哪些步骤]
- 改造建议：[从 Mock 到真实]

## 5️⃣ 自测用例清单
- 用例 1：正常流程
- 用例 2：异常流程
- 用例 3：边界场景

## 6️⃣ 整体结论
- ✅ 可上线功能：[列表]
- ⚠️ 部分完成：[列表]
- ❌ 待开发：[列表]
```

---

## 🎯 质量标准

### 可上线标准 ✅

- ✅ 所有页面可正常访问和跳转
- ✅ 核心业务流程可完整走通
- ✅ 所有接口有错误处理
- ✅ 表单有基础校验
- ✅ 有明确的成功/失败反馈
- ✅ 双主题完整适配
- ✅ 无明显 UI 错误（布局、样式）

### 半成品标记 ⚠️

- ⚠️ 使用 Mock 数据（标记为"演示版"）
- ⚠️ 部分接口未开发（标记为"开发中"）
- ⚠️ 缺少边界场景处理

---

## 📊 检查模板（快速上手）

```markdown
# XX 功能业务流程检查

**检查时间**: 2025年XX月XX日  
**涉及页面**: 4 个  
**业务流程**: XXX → XXX → XXX

## ✅ 前端检查
- 路由跳转：[结果]
- 数据加载：[结果]
- 错误处理：[结果]
- 表单校验：[结果]
- UI 一致性：[结果]

## ✅ 接口检查
[接口清单表格]

## ✅ 业务流程
[数据流描述]

## ✅ 自测用例
[用例清单]

## 📊 结论
- 可上线：X 个功能
- 待完善：X 个功能
- 待开发：X 个功能
```

---

## 🔄 持续优化

### 每次检查后的输出

1. **修改清单**：本次检查发现并修复的问题
2. **待办事项**：需要后续处理的项目
3. **用例文档**：保存到项目文档中供后续测试

### 文档记录

每次检查完成后，记录到：
- `docs/8-问题跟踪文档.md` - 问题和修复
- `docs/1-项目进度文档.md` - 检查完成记录
- `docs/测试用例文档.md` - 自测用例归档（可新建）

---

## 🎓 最佳实践

### 检查时机建议

| 场景 | 建议 |
|------|------|
| **第一期功能** | 每完成 1 条流程就检查 |
| **成熟期** | 每完成 4 个页面检查一次 |
| **重大发布前** | 全面检查所有流程 |

### 检查深度建议

| 阶段 | 检查深度 |
|------|----------|
| **MVP 阶段** | 基础流程 + 核心接口 |
| **Beta 阶段** | 全面检查 + 边界场景 |
| **正式发布** | 包含性能测试和安全检查 |

---

## 📌 重要提醒

1. **不要为了快而跳过检查** - 后期修复成本更高
2. **Mock 数据要明确标记** - 避免误认为已完成
3. **边界场景同样重要** - 不只是正常流程
4. **文档同步更新** - 检查结果要归档

---

**本规范确保每个功能模块都达到"可上线"标准，而非半成品堆砌。** ✅

