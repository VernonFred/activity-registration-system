# 约定文档

> **创建时间**: 2025年12月09日 11:30  
> **最后更新**: 2025年12月09日 11:30  
> **维护人**: 用户 + Cursor AI  
> **状态**: 🔴 重要 - 所有开发必须遵守

---

## 📋 文档说明

本文档汇总了用户与 AI 协作过程中确认的所有约定。**开发任何功能前必须阅读本文档。**

---

## 🔴 核心开发原则

### 1. 分步骤开发，避免返工

> ✅ **用户确认（2025年12月09日）**

| 原则 | 说明 |
|------|------|
| **分步骤完成** | 每个功能分多个步骤完成，不要一次性做太多 |
| **不反复修改样式** | 样式确定后不要来回调整，避免浪费时间 |
| **避免返工** | 每一步做完做好，不要后面推翻前面的设计 |
| **弹性空间** | 可以有小遗漏后续补充，但不能大面积遗漏 |

### 2. 前后端同步开发

> ✅ **用户确认（2025年12月09日）**

| 原则 | 说明 |
|------|------|
| **逐步完善** | 每开发一个页面，同步完善对应的字段、API、路由、数据模型 |
| **不大面积遗漏** | 每个页面完成后，检查前后端数据对接是否完整 |
| **Mock 先行** | 前端先用 Mock 数据开发，但要记录需要的 API 字段 |
| **页面完成即检查** | 每完成 2-3 个页面，进行一次前后端对接检查 |

### 3. 产品逻辑 + UI 外衣

> ✅ **用户确认（2025年12月09日）**

| 原则 | 说明 |
|------|------|
| **产品逻辑** | 严格按照设计稿的产品结构和功能 |
| **UI 外衣** | AI 发挥审美能力，用 Lovable 风格美化 |
| **设计稿优先** | 开发页面前必须先查看 `小程序端设计/` 对应的设计稿 |

---

## 📁 设计参考来源

### 必须查看的设计稿目录

| 优先级 | 目录 | 用途 |
|--------|------|------|
| 🔴 必看 | `小程序端设计/` | 产品结构和功能的权威参考 |
| 🟡 参考 | `管理端参考样式/` | 管理端后台设计参考 |
| 🟢 美化 | `lovable参考样式/` | UI 风格美化参考 |
| 🟢 参考 | `lovable参考样式代码/` | 组件实现参考 |

---

## 🎨 设计规范约定

### 设计风格

| 项目 | 约定 | 确认时间 |
|------|------|----------|
| **风格名称** | Lovable 风格 | 2025年12月02日 |
| **主色调** | 橙色 #FF8A1A → #FF9933 | 2025年12月02日 |
| **阴影风格** | Floating Island 柔和扩散阴影 | 2025年12月02日 |
| **圆角** | 大圆角 16rpx - 32rpx | 2025年12月02日 |

### 主题切换

| 项目 | 约定 | 确认时间 |
|------|------|----------|
| **切换方式** | 单按钮切换，点击即切换浅色/深色 | 2025年12月09日 |
| **不使用** | 三选项开关（跟随系统/普通/暗黑） | 2025年12月09日 |
| **默认主题** | 深色模式 | 2025年12月02日 |
| **所有页面** | 必须同时支持浅色和深色主题 | 2025年12月02日 |

---

## 💻 代码规范约定

### 文件行数限制

> ✅ **用户确认（2025年12月09日）** - 基于行业通用标准 + 本项目实际情况

| 文件类型 | 推荐行数 | 最大容忍 | 说明 |
|----------|----------|----------|------|
| 组件 TSX | 150-250 行 | **400 行** | 单一职责，超过就拆分子组件 |
| 页面 TSX | 200-350 行 | **500 行** | 页面入口，复杂逻辑提取到 hooks/utils |
| 样式 SCSS | 300-500 行 | **800 行** | 双主题约占 40%，需清晰分区注释 |
| 工具函数 | 50-150 行 | **200 行** | 高内聚，单一功能 |
| 类型定义 | 50-100 行 | **200 行** | 按模块分组 |

**行业参考**：Airbnb（函数≤50行）、Google（文件≤500行）、SonarQube（文件≤1000行）

### 强制拆分阈值

| 阈值 | 动作 |
|------|------|
| 超过最大容忍 | 🔴 必须立即拆分 |
| 接近最大容忍（90%） | 🟡 下次修改时拆分 |

### 禁止事项

| 类型 | 禁止内容 | 替代方案 |
|------|----------|----------|
| **图标** | ❌ Emoji 作为图标 | ✅ PNG 图标 |
| **图标** | ❌ 直接导入 SVG | ✅ PNG 图标 |
| **图片** | ❌ 超过 100KB 的图片 | ✅ 压缩后使用 |
| **类型** | ❌ 使用 any 类型 | ✅ 明确类型定义 |
| **颜色** | ❌ 硬编码颜色值 | ✅ 使用 SCSS 变量 |
| **样式** | ❌ 内联样式 | ✅ SCSS 类名 |

---

## 📝 文档同步约定

### 时间戳格式

```
YYYY年MM月DD日 HH:mm
```

示例：`2025年12月09日 11:30`

### 文档更新要求

| 时机 | 需要更新的文档 |
|------|----------------|
| 完成一个任务 | `1-项目进度文档.md`, `16-下一步规划文档.md` |
| 遇到问题 | `8-问题跟踪文档.md` |
| 新增约定 | `约定文档.md`（本文档） |
| 修改代码规范 | `2-代码规范文档.md` |
| 修改设计规范 | `6-设计规范文档.md` |

### 每次对话结束前

1. ✅ 进度更新到 `1-项目进度文档.md`
2. ✅ 新任务添加到 `16-下一步规划文档.md`
3. ✅ 问题记录到 `8-问题跟踪文档.md`
4. ✅ 代码提交到 GitHub

---

## 🔧 依赖安装约定

> ⚠️ **AI 不能直接安装依赖**

| 步骤 | 操作者 |
|------|--------|
| 1. 告知需要安装的依赖 | AI |
| 2. 提供完整的安装命令 | AI |
| 3. 执行安装命令 | 用户 |
| 4. 确认安装结果 | AI |

示例：
```bash
# AI 提供命令，用户执行
cd /Users/Python项目/活动报名系统/frontend/app
pnpm add xxx
```

---

## 🔗 前后端对接约定

### 开发流程

```
Phase 1: 前端 Mock 开发
    ↓
Phase 2: 页面完成后，确认 API 字段
    ↓
Phase 3: 后端补充缺失字段/API
    ↓
Phase 4: 联调测试
```

### 每个页面完成后检查

| 检查项 | 说明 |
|--------|------|
| 需要的 API 接口 | 记录到 `16-下一步规划文档.md` |
| 需要的数据库字段 | 记录到 `16-下一步规划文档.md` |
| Mock 数据结构 | 与后端 API 响应格式一致 |
| 类型定义 | 前后端字段名称一致 |

### 不能遗漏的内容

| 类型 | 具体内容 |
|------|----------|
| **字段** | 每个页面需要展示的所有字段 |
| **API** | 每个功能需要调用的所有接口 |
| **路由** | 页面跳转和参数传递 |
| **数据模型** | TypeScript 类型定义 |

---

## 🚀 开发检查清单

### 开发页面前

- [ ] 阅读本约定文档
- [ ] 查看 `小程序端设计/` 对应的设计稿
- [ ] 确认页面需要的数据和 API

### 开发页面中

- [ ] 分步骤完成，不一次性做太多
- [ ] 每个步骤确认后再进行下一步
- [ ] 支持浅色/深色双主题

### 开发页面后

- [ ] 检查前后端数据对接
- [ ] 记录需要的 API 字段
- [ ] 更新进度文档
- [ ] H5 预览测试

---

## 📝 变更记录

| 时间 | 变更内容 | 操作人 |
|------|----------|--------|
| 2025年12月09日 11:30 | 创建文档，汇总所有协作约定 | Cursor AI |

---

## ✅ 用户确认记录

| 约定内容 | 确认时间 | 来源 |
|----------|----------|------|
| Lovable 风格 + 橙色主调 | 2025年12月02日 18:30 | 设计规范文档 |
| 双主题支持（浅色/深色） | 2025年12月02日 | 设计规范文档 |
| 单按钮主题切换 | 2025年12月09日 11:05 | 设计规范文档 |
| 图标只用 PNG，禁止 Emoji/SVG | 2025年12月02日 | 代码规范文档 |
| 分步骤开发，不反复修改 | 2025年12月09日 | 问题跟踪文档 #525 |
| 产品逻辑 + AI 的 UI 外衣 | 2025年12月09日 | 问题跟踪文档 #525 |
| 逐步完善字段/API/路由/模型 | 2025年12月09日 11:25 | 用户确认 |
| 不做返工，允许小遗漏 | 2025年12月09日 11:25 | 用户确认 |
| **每日代码行数检查（质量标准）** | 2025年12月09日 20:20 | 代码规范文档 |
| **业务流程检查（4 页面或完整流程）** | 2025年12月09日 20:20 | 业务流程检查规范 |

---

## 📊 每日例行检查（必须执行）

### 1. 代码行数检查 ✅

**执行时机**：每日工作结束前

**检查标准**：参考 [代码规范文档](./2-代码规范文档.md)

| 文件类型 | 合理行数 | 最大容忍 | 超标处理 |
|----------|----------|----------|----------|
| 组件 TSX | 150-250 行 | 400 行 | 拆分组件 |
| 页面 TSX | 200-350 行 | 500 行 | 拆分组件 |
| 样式 SCSS | 300-500 行 | 800 行 | 拆分 Partial |
| 工具函数 | 50-150 行 | 200 行 | 拆分模块 |
| 类型定义 | 50-100 行 | 200 行 | 拆分文件 |

**检查命令**：
```bash
cd frontend/app/src
for file in $(find . -type f \( -name "*.tsx" -o -name "*.ts" -o -name "*.scss" \)); do 
  echo "$(wc -l < "$file") $file"; 
done | sort -rn | head -20
```

**输出格式**：
```markdown
## 📊 YYYY年MM月DD日 代码行数检查

| 文件 | 行数 | 类型 | 标准 | 状态 |
|------|------|------|------|------|
| search/index.scss | 681 | 样式 | 800 | ⚠️ 接近上限 |
| activity-detail/index.tsx | 334 | 页面 | 500 | ✅ 合理 |
```

**记录位置**：`docs/8-问题跟踪文档.md` 或 `docs/代码质量日志.md`

---

### 2. 业务流程检查 ✅

**执行时机**：
- 完成 4 个相关页面后
- 完成一条完整业务流程后
- 阶段性里程碑完成后

**检查标准**：参考 [业务流程检查规范](./业务流程检查规范.md)

**触发指令**：
```text
"对这几个页面进行'页面流程检查'。"
"检查报名流程是否能走通。"
```

**检查内容**：
1. ✅ 页面级检查（路由/数据/错误/表单/UI）
2. ✅ 接口检查（清单/结构/错误）
3. ✅ 业务流程（端到端/数据持久化）
4. ✅ 自测用例清单

**输出格式**：业务流程检查报告（详见规范文档）

**记录位置**：`docs/8-问题跟踪文档.md`

---

### 3. 每日文档同步更新 ✅ 🔴 **【非常重要】**

**执行时机**：每日工作结束前（当用户说"今天工作结束"时）

**核心原则**：**一天结束前，必须更新所有相关文档，确保文档与代码实际状态完全同步。**

---

#### 📋 必须检查的文档清单

| 文档 | 检查内容 | 触发条件 |
|------|----------|----------|
| **1-项目进度文档.md** | 今日完成工作、进度百分比 | 每日必更新 |
| **3-API接口文档.md** | 新增/修改的接口 | 有接口变更时 |
| **4-数据库表文档.md** | 新增表、修改字段、JSON结构 | 有数据结构变更时 |
| **5-产品架构文档.md** | 架构调整、模块重构 | 有架构变更时 |
| **10-组件库文档.md** | 新增/修改组件 | 有组件变更时 |
| **8-问题跟踪文档.md** | 修复记录、待确认事项 | 每日必更新 |
| **16-下一步规划文档.md** | 任务状态更新 | 有任务完成时 |

---

#### 🔍 检查方法（逐项检查）

**第一步：识别今日变化**

```markdown
今日变化自查清单：
✅ 是否新增/修改了 API 接口？
✅ 是否新增/修改了数据库表字段？
✅ 是否新增/修改了组件？
✅ 是否调整了产品架构？
✅ 是否新增了类型定义？
✅ 是否完成了计划中的任务？
```

**第二步：逐项更新文档**

1. **API接口文档**
   - 更新"最后更新"时间
   - 在"接口变更记录"表格中添加新行
   - 补充接口详细说明（如有新增）

2. **数据库表文档**
   - 更新"最后更新"时间
   - 在"表变更记录"表格中添加新行
   - 如果是 JSON 字段变化，补充 JSON 结构说明

3. **组件库文档**
   - 更新"最后更新"时间
   - 在"组件变更记录"表格中添加新行
   - 在"组件清单"中添加新组件
   - 补充组件使用示例

4. **产品架构文档**
   - 更新"最后更新"时间和版本号
   - 在"架构变更记录"表格中添加新行
   - 如有重大架构调整，更新架构图

5. **项目进度文档**
   - 更新"项目当前位置"（时间、阶段、进度）
   - 在"每日进度记录"中添加今日总结
   - 更新"模块进度表"中的百分比

6. **问题跟踪文档**
   - 添加今日修复记录
   - 添加代码行数检查报告
   - 添加待明日确认的事项

7. **下一步规划文档**
   - 将已完成任务标记为"✅ 已完成"
   - 更新任务的实际用时
   - 添加新的待办任务（如有）

---

#### 📝 文档更新示例

**API接口文档变更记录示例**：
```markdown
| 时间 | 变更类型 | 接口路径 | 变更内容 | 操作人 |
|------|----------|----------|----------|--------|
| 2025年12月09日 19:30 | 修改 | `/activities/{id}` | 返回的 agenda 字段支持嵌套结构 | Cursor AI |
```

**数据库表文档变更记录示例**：
```markdown
| 时间 | 变更类型 | 表名 | 变更内容 | 操作人 |
|------|----------|------|----------|--------|
| 2025年12月09日 19:30 | 修改 | activities | agenda 字段支持嵌套结构（JSON） | Cursor AI |
```

**组件库文档变更记录示例**：
```markdown
| 时间 | 变更类型 | 组件名 | 变更内容 | 操作人 |
|------|----------|--------|----------|--------|
| 2025年12月09日 19:30 | 新增 | AgendaGroupCard | 议程分组卡片（支持折叠/展开） | Cursor AI |
```

---

#### ⚠️ 重要提醒

1. **不要遗漏**：即使变化很小，也要记录（如修改了一个字段的类型）
2. **时间精确**：记录时间精确到分钟（格式：YYYY年MM月DD日 HH:mm）
3. **描述清晰**：变更内容要具体，不要写"更新"、"修改"等模糊词汇
4. **一次提交**：所有文档更新完成后，一次性提交到 Git

---

#### 🔄 工作流程

```
用户说"今天工作结束"
      ↓
1. 回顾今日所有变化
      ↓
2. 逐项检查文档清单
      ↓
3. 更新所有相关文档
      ↓
4. Git 提交（文档更新）
      ↓
5. 输出今日工作总结
```

---

#### 📊 输出格式

**今日文档同步完成报告**：
```markdown
## ✅ 今日文档同步完成

**更新时间**: 2025年12月XX日 XX:XX
**更新文档**: X 个

| 文档 | 更新内容 | 状态 |
|------|----------|------|
| API接口文档 | 新增 X 个接口 | ✅ |
| 数据库表文档 | 修改 activities.agenda 字段 | ✅ |
| 组件库文档 | 新增 X 个组件 | ✅ |
| 产品架构文档 | 架构版本更新至 v2.X | ✅ |
| 项目进度文档 | 今日总结 + 进度更新 | ✅ |

**Git 提交**: ✅ docs: 今日文档同步更新
```

---

**此规范确保文档与代码始终保持同步，避免文档滞后导致的混乱。** 🔴

---

**下次更新**: 新增约定时同步更新

